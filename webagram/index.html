<!doctype html>
<!--
Copyright 2013 The Polymer Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<html>

<head>
  <title>Webagram</title>
  <script src="https://www.google.com/jsapi"></script>

  
  <!-- pull in polymer -->
  <script src="scripts/polymer-all/polymer/polymer.js"></script>
  <!-- import elements -->
  <link rel="import" href="scripts/polymer-all/polymer-elements/polymer-view-source-link/polymer-view-source-link.html">
  <link rel="import" href="scripts/polymer-all/polymer-elements/polymer-page/polymer-page.html">
  <link rel="import" href="scripts/polymer-all/polymer-elements/polymer-layout/polymer-layout.html">
  <link rel="import" href="scripts/polymer-all/polymer-elements/polymer-layout/polymer-slide.html">
  <link rel="import" href="scripts/polymer-all/polymer-ui-elements/polymer-ui-toolbar/polymer-ui-toolbar.html">
  <link rel="import" href="scripts/polymer-all/polymer-ui-elements/polymer-ui-icon-button/polymer-ui-icon-button.html">
  <link rel="import" href="scripts/polymer-all/polymer-ui-elements/polymer-ui-menu/polymer-ui-menu.html">
  <link rel="import" href="scripts/polymer-all/polymer-ui-elements/polymer-ui-menu-item/polymer-ui-menu-item.html">
  <link rel="import" href="scripts/polymer-all/projects/pica/components/pi-feed-aggregator.html"/>
  <link rel="import" href="scripts/polymer-all/projects/pica/components/pi-items-view.html"/>

  <!-- regular styling -->
  <link rel="stylesheet" href="scripts/polymer-all/polymer-ui-elements/basic.css">
  <link rel="stylesheet" href="src/css/index.css">
</head>

<body class="polymer-ui-body-text polymer-ui-dark-bg" theme="polymer-ui-dark-theme">

  <!-- just an element, this one makes document.body fit the viewport -->
  <polymer-page fullbleed></polymer-page>

  <!-- just an element, arranges sibling elements to fit their container -->
  <polymer-layout vertical></polymer-layout>


  <section class="splash" fit>
    <div class="logo">
      <img src="src/images/camera.png"/>
      <p>Webagram</p>
    </div>
  </section>

  <section fit>
    <polymer-layout></polymer-layout>

    <section class="sidebar polymer-ui-dark-bg">
      <polymer-slide id="slide" closed></polymer-slide>
      <polymer-layout vertical></polymer-layout>

      <section class="logo">
        <img src="src/images/camera.png"> Webagram
      </section>

      <!-- look-n-feel elements (aka widgets) -->
      <polymer-ui-menu fit>
        <polymer-ui-menu-item icon="dialog"><a href="../2. Not Just Widgets/">Settings</a></polymer-ui-menu-item>
      </polymer-ui-menu>
    </section>

    <section fit>
      <polymer-layout vertical></polymer-layout>

      <!-- look-n-feel elements (aka widgets) -->
      <polymer-ui-toolbar>
        <polymer-ui-icon-button icon="drawer" onclick="document.querySelector('#slide').toggle()"></polymer-ui-icon-button>
        <span id="header-title" fit>&nbsp;Activity</span>
      </polymer-ui-toolbar>
  

      <section fit class="main polymer-ui-light-bg">
        
        <!-- grid view -->
        <section id="activity" class="panel activity">
          <pi-items-view view="topics" layout="grid"></pi-items-view>
        </section>

        <!--capture view-->
        <section id="capture" class="panel capture">
          <p>Record a new animated GIF</p>
  
          <div class="preview">
            <video id="video" autoplay></video>
            <canvas id="canvas"></canvas>
          </div>

          <div class="replay">
            <img width=360 height=360 src="" id="replay-screen">
          </div>

          <polymer-ui-toolbar class="main polymer-ui-light-bg" theme="polymer-ui-light-theme">
            <polymer-ui-icon-button src="src/images/media_record.png" onclick=""></polymer-ui-icon-button>
            <polymer-ui-icon-button src="src/images/stop.png" onclick=""></polymer-ui-icon-button>
            <polymer-ui-icon-button src="src/images/play.png" onclick=""></polymer-ui-icon-button>
            <polymer-ui-icon-button src="src/images/save.png" onclick=""></polymer-ui-icon-button>
            <polymer-ui-icon-button src="src/images/delete.png" onclick=""></polymer-ui-icon-button>
          </polymer-ui-toolbar>

        </section>

        <!--settings-->
        <section id="settings" class="panel settings">

          <div class="header item">Encoder</div>
          <div class="item no-border">
            <div class="item-input-label">Quality: </div>
            <input id="feed" type="url" class="flex" operation="addFeed" on-keyup="keyupHandler" value="10"/>
            <g-icon-button src="../images/add.png" on-tap="addFeed"></g-icon-button>
          </div>

        </section>


      </section>

      <polymer-ui-toolbar>
        <polymer-ui-icon-button src="src/images/toolbar_activity.png" onclick="switchPanel('activity', 'Activity')"></polymer-ui-icon-button>
        <polymer-ui-icon-button src="src/images/toolbar_camera.png" onclick="switchPanel('capture', 'Capture')"></polymer-ui-icon-button>
        <polymer-ui-icon-button src="src/images/toolbar_settings.png" onclick="switchPanel('settings', 'Settings')"></polymer-ui-icon-button>
      </polymer-ui-toolbar>

    </section>

  <script>

  function switchPanel(label, titleStr){
     var panels = document.querySelectorAll('.panel');
     var title = document.querySelector('#header-title');

     title.innerHTML = '&nbsp;' + titleStr;

     for(var i=0; i<panels.length;i++){
        el = panels[i];
        el.style.display = 'none';

        if(el.className === 'panel ' + label){
          el.style.display = 'block';
        }
     }    
  }

  document.addEventListener('WebComponentsReady', function() {

   var splash = document.querySelector('.splash');
   var panels = document.querySelectorAll('.panel');
   var itemsView = document.querySelector('pi-items-view');
   var el;


   // Hide all panels
   /*
   for(var i=0; i<panels.length;i++){
      el = panels[i];
      el.style.display = 'none';

      if(el.className === 'panel active'){
        el.style.display = 'block';
      }
   }*/
 
    setTimeout(function(){
      splash.style.display = "none";
    }, 2000);


    itemsView.items = [];
    itemsView.items.push({
        title: 'Image.gif', 
        feed: [{
          title: 'Indie Shuffle', 
          feed: 'http://feeds.feedburner.com/indieshuffle'
        }]
      });

      fetchImageForTopics(itemsView.items);
    });

    
    function fetchImageForTopics(inTopics) {
      inTopics.forEach(function(t) {
        t.imgSrc = '';
        var fa = document.createElement('pi-feed-aggregator');
        fa.cancelUnbindAll();
        fa.count = 4;
        fa.addEventListener('response', function(e) {
          var ns = e.detail && e.detail.entries || [];
          for (var i = 0, n; n = ns[i]; i++) {
            if (n.imgSrc) {
              t.imgSrc = n.imgSrc;
              t.unread = 200;
              return;
            }
          }
          fa.unbindAll();
        });
        fa.feed = t.feed;
      });
    }
  </script>

  </section>

</body>
</html>
